#!/bin/sh

echo "üîç Running pre-commit checks..."

# Get staged JS/TS files excluding .husky directory
RAW_FILES=$(git diff --name-only origin/develop...HEAD | grep -E '\.(js|ts|jsx|tsx)$' || true)

FILES=""
for file in $RAW_FILES; do
  if [ -f "$file" ]; then
    FILES="$FILES $file"
  fi
done

if [ -z "$FILES" ]; then
  echo "‚úÖ No JS/TS files to check."
  exit 0
fi

echo "üîé Files being checked:"
echo "$FILES"

FOUND_LOGS=false
HAS_PRETTIER_ERRORS=false

# Check for console.log
for file in $FILES; do
  if [ -f "$file" ]; then
    echo "üëÄ Checking $file"
    if grep -Eq "console(\s*\.\s*|\s*\[\s*['\"]log['\"]\s*\])" "$file"; then
      echo "‚ùå Found console.log in $file"
      grep -En "console(\s*\.\s*|\s*\[\s*['\"]log['\"]\s*\])" "$file"
      FOUND_LOGS=true
    fi
  fi
done

echo "‚úÖ All pre-commit checks passed."
exit 0
